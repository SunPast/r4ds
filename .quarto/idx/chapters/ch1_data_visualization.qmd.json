{"title":"数据可视化","markdown":{"yaml":{"title":"数据可视化","format":"html"},"headingText":"引言","containsRefs":false,"markdown":"\n\n\nggplot2是所有R可视化工具中最优雅的之一。 本章需载入下列R包：\n\n``` r\nlibrary(tidyverse)\nlibrary(palmerpenguins) # 包含示例数据\nlibrary(ggthemes) # 提供色盲调色板\n```\n\n## 绘制企鹅数据图\n\n本书开篇甩出一系列问题：企鹅的脚蹼长度和体重之间的关系是怎样的？是线性？非线性？这种关系是否因企鹅的种类而异？与地理位置有关吗？针对这些问题，我们将进行可视化操作以回答。\n\n首先了解一些术语：\n\n-   **变量(variable**)是可以测量的数量、质量等属性。\n-   **值(value**)是测量变量时变量的状态。变量的值可能会因测量而异。\n-   **观测值(observation**)是在相近条件下进行的一组测量 （通常就是在同一时间对同一对象的所有值）。一个观测值将包含多个值，每个值都与不同的变量相关联。\n-   **表格数据(tabular data**)是一组值，每个值都与一个变量和一个观测值相关联。\n\n接下来输入`palmerpenguins::penguins`以打开示例数据的数据框。注意到并未显示出所有变量。\n\n``` r\n> palmerpenguins::penguins\n# A tibble: 344 × 8\n   species island  bill_length_mm bill_depth_mm\n   <fct>   <fct>            <dbl>         <dbl>\n 1 Adelie  Torger…           39.1          18.7\n 2 Adelie  Torger…           39.5          17.4\n 3 Adelie  Torger…           40.3          18  \n 4 Adelie  Torger…           NA            NA  \n 5 Adelie  Torger…           36.7          19.3\n 6 Adelie  Torger…           39.3          20.6\n 7 Adelie  Torger…           38.9          17.8\n 8 Adelie  Torger…           39.2          19.6\n 9 Adelie  Torger…           34.1          18.1\n10 Adelie  Torger…           42            20.2\n# ℹ 334 more rows\n# ℹ 4 more variables: flipper_length_mm <int>,\n#   body_mass_g <int>, sex <fct>, year <int>\n# ℹ Use `print(n = ...)` to see more rows\n```\n\n也可使用`glimpse(penguins)`，查看所有变量和每个变量的前几个观测值的替代视图。\n\n``` r\n> glimpse(penguins)\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Ad…\n$ island            <fct> Torgersen, Torgersen, Torgersen, T…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, …\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, …\n$ sex               <fct> male, female, female, NA, female, …\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007…\n```\n\n此外还可运行`view(penguins)`，打开交互式数据查看器。\n\n我们的目标是用可视化图显示这些企鹅的脚蹼长度和体重、种类之间的关系。所以接下来开始介绍`ggplot()`这一核心函数。\n\n第一个参数是**data**，表示我们绘图所需的数据集，此处即`ggplot(data = penguins)`。但由于我们还没有声明具体绘图方式，因此现在画布尚为空白。\n\n第二个参数为**mapping**，通常与美学函数(aes)成对出现。`aes()`函数中x和y的参数要分别映射到 x 轴和 y 轴，在本例中，我们将脚蹼长度映射到x，将体重映射到y，ggplot2 会在参数中查找映射的变量。故而输入：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n)\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-8-1.png)\n\n现在画布上出现了坐标轴，脚蹼长度为 x 轴，体重为 y 轴。但是还没有图线，因为尚未设置绘图模板。\n\n下面定义绘图模板**geom (geometric object)**。不同类型的图以不同类型的基础几何图形组成。 - 条形图使用条形 `geom_bar()` - 折线图使用线`geom_line()` - 箱线图使用箱型 `geom_boxplot()` - 散点图使用点`geom_point()`\n\n注意geom函数与ggplot函数是并列的，二者以加号相连。不妨尝试画一个散点图：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point()\n#> Warning: Removed 2 rows containing missing values or values outside the scale range\n#> (`geom_point()`).\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-9-1.png)\n\n我们注意到生成图像时有警告信息，是因为数据中有两只企鹅缺少体重或脚蹼长度值，ggplot2 无法在图上表示缺失值。ggplot2 贯彻**不让任何缺失值静默地缺失**这一理念。\n\n接下来，我们需要将物种这一变量纳入图中，可以通过使用不同颜色的点来表示不同物种。使用`color=<变量>`参数即可实现。绘制完成后可以发现ggplot2帮我们附上了一个图例。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = species)\n) +\n  geom_point()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-10-1.png)\n\n为了让图像更直观，最好再添加一个图层，以显示体重和脚蹼长度之间关系的平滑曲线，用`geom_smooth()`函数表示。由于平滑曲线是一个新的几何对象，与散点图并存，故而函数`geom_smooth(method = \"lm\")`也应独立，用加号连接。其中`lm`表示线性模型(linear model)。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = species)\n) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-11-1.png)\n\n此代码输出的图包含三条线，分别表示三个物种，看起来颇为凌乱。如果曲线的对象是整个数据，就能做到只输出一条总线，那么如何设置？\n\n实际上，`ggplot`函数里的参数是影响所有`geom`的，而各个`geom`函数里的参数则各自为营而互不干扰。因此可让颜色只在散点图中作为物种区分，从而不影响平滑曲线：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point(mapping = aes(color = species)) +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-13-1.png)\n\n现在得到的图像美观多了，但仍有进步空间。考虑到色盲人士，只用颜色区分物种貌似不太妥当，可以将点改为多种形状来区分。使用`shape=<变量>`参数即可实现。同样也会附上图例。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point(mapping = aes(color = species, shape = species)) +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-12-1.png)\n\n最后一步，我们可以添加一个用于解释图像的函数`labs()`，从而为图添加标题和副标题，并以与美学映射匹配的方式添加坐标轴文字，并定义图例的标签等等。此外，还可以使用 `ggthemes` 包中的函数改进调色板，进一步照顾色盲人士。\n\n``` r\n> ggplot(\n+     data = penguins,\n+     mapping = aes(x = flipper_length_mm, y = body_mass_g)\n+ ) +\n+     geom_point(aes(color = species, shape = species)) +\n+     geom_smooth(method = \"lm\") +\n+     labs(\n+         title = \"Body mass and flipper length\",\n+         subtitle = \"Dimensions for Adelie, Chinstrap, and Gentoo Penguins\",\n+         x = \"Flipper length (mm)\", y = \"Body mass (g)\",\n+         color = \"Species\", shape = \"Species\"\n+     ) +\n+     scale_color_colorblind()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-14-1.png)\n\n## 调用 ggplot2\n\n`ggplot`函数的核心用法已阐述完毕，下面将以更简洁的形式呈现，省略参数名称（data和mapping）。所以上一节中的某一命令可简化为：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point()\n```\n\n当然也可以借助R的管道进行简化：\n\n``` r\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) + \n  geom_point()\n```\n\n## 分布可视化\n\n如果要将企鹅的种类等**类别变量(categorical variable)**可视化，可使用条形图`geom_bar()`如下：\n\n``` r\nggplot(penguins, aes(x = species)) +\n  geom_bar()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-22-1.png)\n\n如此便可生成对应条形图，但是排列是无序的。借助`fct_infreq()`函数按照每个类别的数量进行降序排序：\n\n``` r\nggplot(penguins, aes(x = fct_infreq(species))) +\n  geom_bar()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-23-1.png)\n\n如果要对企鹅的体重等**数值变量(numerical variable)**进行可视化，可使用直方图`geom_histogram()`：\n\n``` r\nggplot(penguins, aes(x = body_mass_g)) +\n  geom_histogram(binwidth = 200)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-24-1.png)\n\n指令中的 `binwidth` 参数设置直方图中的间隔宽度。在应用直方图时，需要尝试多种 `binwidth`参数，以找到最顺眼且最合理的样式。比如设置为20时显然过于密集了：\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-25-1.png)\n\n数值分布还可以用密度图`geom_density()`进行可视化，相当于连接直方图各个长条的顶点绘制的曲线：\n\n``` r\nggplot(penguins, aes(x = body_mass_g)) +\n  geom_density()\n#> Warning: Removed 2 rows containing non-finite outside the scale range\n#> (`stat_density()`).\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-26-1.png)\n\n## 关系可视化\n\n为了可视化变量间的关系，我们需要将至少两个变量映射到美学。下面将介绍用于可视化两个或多个变量之间关系的常用绘图。\n\n### 数值变量和类别变量\n\n要对数值变量和类别变量进行关系可视化，可使用箱线图`geom_boxplot()`。\n\n箱线图由以下部分组成：\n\n-   一个表示数据中间半部分范围的框，该距离称为四分位距 （IQR），从分布的第 25 个百分位数延伸到第 75 个百分位数。框中间有一条横线，显示分布的中位数，即第 50 个百分位数。这三条线体现数据的分散程度，以及分布是关于中位数对称还是偏向于某一侧。\n-   超过框的任一边缘 IQR 1.5 倍的观测值的数据会以点的形式单独标注，称为outliers。\n-   从框的两端延伸并到达最远的**非异常值点**的线称作须线(whisker)。\n\n![](https://r4ds.hadley.nz/images/EDA-boxplot.png)\n\n现在使用箱线图将企鹅体重与物种的关系可视化：\n\n``` r\nggplot(penguins, aes(x = species, y = body_mass_g)) +\n  geom_boxplot()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-28-1.png)\n\n关系的可视化也可以使用密度图，不过较前文有所进阶。使用`linewidth`参数自定义线条粗细：\n\n``` r\n> ggplot(penguins, aes(x = body_mass_g, color = species)) +\n+ geom_density(linewidth = 0.75)\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-29-1.png)\n\n可以用`fill`参数为密度曲线填充颜色，同时使用`alpha`参数设置填充的透明度：\n\n``` r\nggplot(penguins, aes(x = body_mass_g, color = species, fill = species)) +\n  geom_density(alpha = 0.5)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-30-1.png)\n\n### 两个类别变量\n\n使用堆叠条形图来可视化两个类别变量的关系。例如要处理物种和岛名的关系：\n\n``` r\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-31-1.png)\n\n像这样直接生成的条形图反映了绝对数值，但是对于各岛企鹅物种占比的对比不太直观。此时可设置参数`position=\"fill\"`的方式让相对频率更直观：\n\n``` r\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar(position = \"fill\")\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-32-1.png)\n\n### 两个数值变量\n\n书中指出，散点图是可视化两个数值变量之间关系的最常用图。\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-33-1.png)\n\n### 三个或更多变量\n\n针对三个变量，我们可以加入更多美学要素以表示变量，比如用点的颜色表示物种，用点的形状表示岛屿：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = island))\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-34-1.png)\n\n但是这样做的缺陷非常明显，图片十分杂乱，若变量更多则更糟糕。故而有另一种方案：**分面**。即使用多个子图以表示**类别变量**。\n\n要进行分面，则使用`facet_wrap()`函数，参数为符号`~`后加上需要分面的类别变量名称。例如将岛屿进行分面：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = species)) +\n  facet_wrap(~island)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-35-1.png)\n\n## 保存绘图\n\n使用`ggsave()`函数保存最近一次所画图像，参数`file`可设置图像名称及路径。比如：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point()\nggsave(filename = \"penguin-plot.png\")\n```\n","srcMarkdownNoYaml":"\n\n## 引言\n\nggplot2是所有R可视化工具中最优雅的之一。 本章需载入下列R包：\n\n``` r\nlibrary(tidyverse)\nlibrary(palmerpenguins) # 包含示例数据\nlibrary(ggthemes) # 提供色盲调色板\n```\n\n## 绘制企鹅数据图\n\n本书开篇甩出一系列问题：企鹅的脚蹼长度和体重之间的关系是怎样的？是线性？非线性？这种关系是否因企鹅的种类而异？与地理位置有关吗？针对这些问题，我们将进行可视化操作以回答。\n\n首先了解一些术语：\n\n-   **变量(variable**)是可以测量的数量、质量等属性。\n-   **值(value**)是测量变量时变量的状态。变量的值可能会因测量而异。\n-   **观测值(observation**)是在相近条件下进行的一组测量 （通常就是在同一时间对同一对象的所有值）。一个观测值将包含多个值，每个值都与不同的变量相关联。\n-   **表格数据(tabular data**)是一组值，每个值都与一个变量和一个观测值相关联。\n\n接下来输入`palmerpenguins::penguins`以打开示例数据的数据框。注意到并未显示出所有变量。\n\n``` r\n> palmerpenguins::penguins\n# A tibble: 344 × 8\n   species island  bill_length_mm bill_depth_mm\n   <fct>   <fct>            <dbl>         <dbl>\n 1 Adelie  Torger…           39.1          18.7\n 2 Adelie  Torger…           39.5          17.4\n 3 Adelie  Torger…           40.3          18  \n 4 Adelie  Torger…           NA            NA  \n 5 Adelie  Torger…           36.7          19.3\n 6 Adelie  Torger…           39.3          20.6\n 7 Adelie  Torger…           38.9          17.8\n 8 Adelie  Torger…           39.2          19.6\n 9 Adelie  Torger…           34.1          18.1\n10 Adelie  Torger…           42            20.2\n# ℹ 334 more rows\n# ℹ 4 more variables: flipper_length_mm <int>,\n#   body_mass_g <int>, sex <fct>, year <int>\n# ℹ Use `print(n = ...)` to see more rows\n```\n\n也可使用`glimpse(penguins)`，查看所有变量和每个变量的前几个观测值的替代视图。\n\n``` r\n> glimpse(penguins)\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Ad…\n$ island            <fct> Torgersen, Torgersen, Torgersen, T…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, …\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, …\n$ sex               <fct> male, female, female, NA, female, …\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007…\n```\n\n此外还可运行`view(penguins)`，打开交互式数据查看器。\n\n我们的目标是用可视化图显示这些企鹅的脚蹼长度和体重、种类之间的关系。所以接下来开始介绍`ggplot()`这一核心函数。\n\n第一个参数是**data**，表示我们绘图所需的数据集，此处即`ggplot(data = penguins)`。但由于我们还没有声明具体绘图方式，因此现在画布尚为空白。\n\n第二个参数为**mapping**，通常与美学函数(aes)成对出现。`aes()`函数中x和y的参数要分别映射到 x 轴和 y 轴，在本例中，我们将脚蹼长度映射到x，将体重映射到y，ggplot2 会在参数中查找映射的变量。故而输入：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n)\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-8-1.png)\n\n现在画布上出现了坐标轴，脚蹼长度为 x 轴，体重为 y 轴。但是还没有图线，因为尚未设置绘图模板。\n\n下面定义绘图模板**geom (geometric object)**。不同类型的图以不同类型的基础几何图形组成。 - 条形图使用条形 `geom_bar()` - 折线图使用线`geom_line()` - 箱线图使用箱型 `geom_boxplot()` - 散点图使用点`geom_point()`\n\n注意geom函数与ggplot函数是并列的，二者以加号相连。不妨尝试画一个散点图：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point()\n#> Warning: Removed 2 rows containing missing values or values outside the scale range\n#> (`geom_point()`).\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-9-1.png)\n\n我们注意到生成图像时有警告信息，是因为数据中有两只企鹅缺少体重或脚蹼长度值，ggplot2 无法在图上表示缺失值。ggplot2 贯彻**不让任何缺失值静默地缺失**这一理念。\n\n接下来，我们需要将物种这一变量纳入图中，可以通过使用不同颜色的点来表示不同物种。使用`color=<变量>`参数即可实现。绘制完成后可以发现ggplot2帮我们附上了一个图例。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = species)\n) +\n  geom_point()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-10-1.png)\n\n为了让图像更直观，最好再添加一个图层，以显示体重和脚蹼长度之间关系的平滑曲线，用`geom_smooth()`函数表示。由于平滑曲线是一个新的几何对象，与散点图并存，故而函数`geom_smooth(method = \"lm\")`也应独立，用加号连接。其中`lm`表示线性模型(linear model)。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = species)\n) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-11-1.png)\n\n此代码输出的图包含三条线，分别表示三个物种，看起来颇为凌乱。如果曲线的对象是整个数据，就能做到只输出一条总线，那么如何设置？\n\n实际上，`ggplot`函数里的参数是影响所有`geom`的，而各个`geom`函数里的参数则各自为营而互不干扰。因此可让颜色只在散点图中作为物种区分，从而不影响平滑曲线：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point(mapping = aes(color = species)) +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-13-1.png)\n\n现在得到的图像美观多了，但仍有进步空间。考虑到色盲人士，只用颜色区分物种貌似不太妥当，可以将点改为多种形状来区分。使用`shape=<变量>`参数即可实现。同样也会附上图例。\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point(mapping = aes(color = species, shape = species)) +\n  geom_smooth(method = \"lm\")\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-12-1.png)\n\n最后一步，我们可以添加一个用于解释图像的函数`labs()`，从而为图添加标题和副标题，并以与美学映射匹配的方式添加坐标轴文字，并定义图例的标签等等。此外，还可以使用 `ggthemes` 包中的函数改进调色板，进一步照顾色盲人士。\n\n``` r\n> ggplot(\n+     data = penguins,\n+     mapping = aes(x = flipper_length_mm, y = body_mass_g)\n+ ) +\n+     geom_point(aes(color = species, shape = species)) +\n+     geom_smooth(method = \"lm\") +\n+     labs(\n+         title = \"Body mass and flipper length\",\n+         subtitle = \"Dimensions for Adelie, Chinstrap, and Gentoo Penguins\",\n+         x = \"Flipper length (mm)\", y = \"Body mass (g)\",\n+         color = \"Species\", shape = \"Species\"\n+     ) +\n+     scale_color_colorblind()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-14-1.png)\n\n## 调用 ggplot2\n\n`ggplot`函数的核心用法已阐述完毕，下面将以更简洁的形式呈现，省略参数名称（data和mapping）。所以上一节中的某一命令可简化为：\n\n``` r\nggplot(\n  data = penguins,\n  mapping = aes(x = flipper_length_mm, y = body_mass_g)\n) +\n  geom_point()\n```\n\n当然也可以借助R的管道进行简化：\n\n``` r\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) + \n  geom_point()\n```\n\n## 分布可视化\n\n如果要将企鹅的种类等**类别变量(categorical variable)**可视化，可使用条形图`geom_bar()`如下：\n\n``` r\nggplot(penguins, aes(x = species)) +\n  geom_bar()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-22-1.png)\n\n如此便可生成对应条形图，但是排列是无序的。借助`fct_infreq()`函数按照每个类别的数量进行降序排序：\n\n``` r\nggplot(penguins, aes(x = fct_infreq(species))) +\n  geom_bar()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-23-1.png)\n\n如果要对企鹅的体重等**数值变量(numerical variable)**进行可视化，可使用直方图`geom_histogram()`：\n\n``` r\nggplot(penguins, aes(x = body_mass_g)) +\n  geom_histogram(binwidth = 200)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-24-1.png)\n\n指令中的 `binwidth` 参数设置直方图中的间隔宽度。在应用直方图时，需要尝试多种 `binwidth`参数，以找到最顺眼且最合理的样式。比如设置为20时显然过于密集了：\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-25-1.png)\n\n数值分布还可以用密度图`geom_density()`进行可视化，相当于连接直方图各个长条的顶点绘制的曲线：\n\n``` r\nggplot(penguins, aes(x = body_mass_g)) +\n  geom_density()\n#> Warning: Removed 2 rows containing non-finite outside the scale range\n#> (`stat_density()`).\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-26-1.png)\n\n## 关系可视化\n\n为了可视化变量间的关系，我们需要将至少两个变量映射到美学。下面将介绍用于可视化两个或多个变量之间关系的常用绘图。\n\n### 数值变量和类别变量\n\n要对数值变量和类别变量进行关系可视化，可使用箱线图`geom_boxplot()`。\n\n箱线图由以下部分组成：\n\n-   一个表示数据中间半部分范围的框，该距离称为四分位距 （IQR），从分布的第 25 个百分位数延伸到第 75 个百分位数。框中间有一条横线，显示分布的中位数，即第 50 个百分位数。这三条线体现数据的分散程度，以及分布是关于中位数对称还是偏向于某一侧。\n-   超过框的任一边缘 IQR 1.5 倍的观测值的数据会以点的形式单独标注，称为outliers。\n-   从框的两端延伸并到达最远的**非异常值点**的线称作须线(whisker)。\n\n![](https://r4ds.hadley.nz/images/EDA-boxplot.png)\n\n现在使用箱线图将企鹅体重与物种的关系可视化：\n\n``` r\nggplot(penguins, aes(x = species, y = body_mass_g)) +\n  geom_boxplot()\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-28-1.png)\n\n关系的可视化也可以使用密度图，不过较前文有所进阶。使用`linewidth`参数自定义线条粗细：\n\n``` r\n> ggplot(penguins, aes(x = body_mass_g, color = species)) +\n+ geom_density(linewidth = 0.75)\n```\n\n![](https://books-zh-cn.github.io/r4ds-zh-cn/data-visualize_files/figure-html/unnamed-chunk-29-1.png)\n\n可以用`fill`参数为密度曲线填充颜色，同时使用`alpha`参数设置填充的透明度：\n\n``` r\nggplot(penguins, aes(x = body_mass_g, color = species, fill = species)) +\n  geom_density(alpha = 0.5)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-30-1.png)\n\n### 两个类别变量\n\n使用堆叠条形图来可视化两个类别变量的关系。例如要处理物种和岛名的关系：\n\n``` r\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-31-1.png)\n\n像这样直接生成的条形图反映了绝对数值，但是对于各岛企鹅物种占比的对比不太直观。此时可设置参数`position=\"fill\"`的方式让相对频率更直观：\n\n``` r\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar(position = \"fill\")\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-32-1.png)\n\n### 两个数值变量\n\n书中指出，散点图是可视化两个数值变量之间关系的最常用图。\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point()\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-33-1.png)\n\n### 三个或更多变量\n\n针对三个变量，我们可以加入更多美学要素以表示变量，比如用点的颜色表示物种，用点的形状表示岛屿：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = island))\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-34-1.png)\n\n但是这样做的缺陷非常明显，图片十分杂乱，若变量更多则更糟糕。故而有另一种方案：**分面**。即使用多个子图以表示**类别变量**。\n\n要进行分面，则使用`facet_wrap()`函数，参数为符号`~`后加上需要分面的类别变量名称。例如将岛屿进行分面：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = species)) +\n  facet_wrap(~island)\n```\n\n![](https://r4ds.hadley.nz/data-visualize_files/figure-html/unnamed-chunk-35-1.png)\n\n## 保存绘图\n\n使用`ggsave()`函数保存最近一次所画图像，参数`file`可设置图像名称及路径。比如：\n\n``` r\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point()\nggsave(filename = \"penguin-plot.png\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"ch1_data_visualization.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","bibliography":["../references.bib"],"editor":"visual","theme":["cosmo","brand"],"title":"数据可视化"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}