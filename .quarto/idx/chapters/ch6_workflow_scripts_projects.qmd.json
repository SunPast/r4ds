{"title":"脚本与项目","markdown":{"yaml":{"title":"脚本与项目","format":"html"},"headingText":"6.1.1 运行代码","containsRefs":false,"markdown":"\n\n\n本章介绍用于组织代码的两个基本要素：脚本、项目。\n\n##脚本\n\n当工作变得更加复杂时，只用控制台运行代码显得力不从心，此时可使用脚本。在 RStudio 中，点击“文件”菜单，选择新建 R 脚本即可出现空白脚本。此时共有四个窗口，如图所示。\n\n![](https://r4ds.hadley.nz/diagrams/rstudio/script.png)\n\n\n脚本编辑器是构建复杂ggplot图或长管道的最佳位置。\n\n快捷键如下：\n\n- Ctrl + Enter，在控制台执行当前一行代码。\n\n- Ctrl + Shift + S，一步执行完整脚本。\n\n建议使用`library(所需的包)`作为脚本开头。这样，如果要共享代码，可以让他人知晓需要安装的软件包。但绝不应包含在共享脚本中加`install.packages(\"包\")`，不太厚道。\n\n### RStudio 诊断\n\n在脚本编辑器中，RStudio 将在左侧边栏中用红色波浪线和叉号突出显示语法错误（前提是脚本已被创建并保存）：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic.png)\n\n将鼠标悬停在红叉上以查看问题：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic-tip.png)\n\nRStudio 还会通过警示符标注潜在问题：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic-warn.png)\n\n### 保存与命名\n\nRStudio 会在退出时自动保存脚本编辑器的内容，并在重新打开时自动重新加载它。尽管如此贴心，但还是建议自己保存并命名。\n\n命名有以下原则：\n\n1. 文件名应该是**机器**可读的：避免使用空格、特殊字符。不要依赖区分大小写来区分文件。\n2. 文件名应该是**人类**可读的：可使用文件名来描述文件内容。\n3. 可让系列文件名以字母或数字顺序开头，以便按实际使用顺序排列它们。\n\n以下举例。请看一个奇葩文件夹中的各文件名：\n\n```R\nalternative model.R #有空格\ncode for exploratory analysis.r #有空格且繁杂\nfinalreport.qmd\nFinalReport.qmd #妄图通过大小写区分文件\nfig 1.png #有空格\nFigure_02.png #与上面fig1格式不统一\nmodel_first_try.R\nrun-first.r #没描述内容\ntemp.txt #没描述内容\n```\n\n修改名称后如下：\n\n```\n01-load-data.R\n02-exploratory-analysis.R\n03-model-approach-1.R\n04-model-approach-2.R\nfig-01.png\nfig-02.png\nreport-2022-03-20.qmd\nreport-2022-04-02.qmd\nreport-draft-notes.txt\n```\n\n\n\n## 项目\n\n有时我们需要暂时退出 R，稍后再返回分析；有时我们需要将外部数据导入 R，处理后再对外反馈。\n\n要处理这两种情况，需要认清两个问题：\n\n1. 真理的源头是什么？或者说什么文件能够永久记录我们曾做过的工作？\n2. 我们所做的分析位于何处？\n\n\n\n### 真理的源头\n\n作为初学者，可以依靠当前 R 环境来保留在整个分析过程中创建的所有对象。但是为了更轻松地处理大型项目或与他人协作，**真理的源头应该是 R 脚本**。\n\n**使用 R 脚本（和数据文件），我们才能重新创建环境。**相反，仅使用当前环境，重新创建 R 脚本则要困难得多，要么必须从内存中重新键入大量代码（在此过程中不可避免地会犯错误），要么必须仔细挖掘 R 历史记录。\n\n为了保证让 R 脚本成为一切事实的根据，强烈建议设置不要在 RStudio 会话之间保留工作区。即做到两点：\n\n- 取消勾选`RData into workspace`\n- 设置`Save workspace to .RData on exit:`为`Never`\n\n如下图所示即可：\n\n![](https://r4ds.hadley.nz/diagrams/rstudio/clean-slate.png)\n\n或许这会带来一些短期的不便，因为现在重新启动 RStudio 时，它将不再记住上次运行的代码，所创建的对象或读取的数据集也将无影无踪。\n\n但是短期的不便可以省去长期的痛苦，它会迫使我们在代码中专注于所有重要的过程。\n\n书中在此推荐两个快捷键：\n\n1. 按 Cmd/Ctrl + Shift + 0/F10 重新启动 R。\n2. 按 Cmd/Ctrl + Shift + S 重新运行当前脚本。\n\n> **RStudio 服务器**\n>\n> 如果使用的是 RStudio 服务器，则默认情况下永远不会重新启动 R 会话。当关闭 RStudio 服务器选项卡时，实际上服务器仍会在后台运行。下次返回时，会发现与上次离开的地方一模一样。因此定期重启变得更加重要，这样才便于从头开始。\n\n\n\n##### 6.2.2 分析文件位于何处？\n\nR 的**工作目录**概念绝不可忽视。这是 R 查找要求它加载的文件的位置，以及它所放置的保存文件的位置。RStudio 在控制台顶部显示当前工作目录：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-wd.png)\n\n可以通过运行`getwd()`命令打印工作目录：\n\n```R\n> getwd()\n[1] \"C:/Users/LENOVO/Desktop/r_packages/BLIT/blit/R\"\n```\n\n可以从 R 中设置工作目录，但书中**不建议这样做**：\n\n```R\n> setwd(\"/path/to/my/CoolProject\")\n```\n\n因为有更好的方法管理工作——RStudio项目。\n\n\n\n### RStudio项目\n\n将项目的所有相关文件（输入数据、R 脚本、分析结果）全部保存在同一个目录中是非常明智的做法， RStudio 也对此提供了内置支持。\n\n下面实操为例，创建一个阅读本书剩余部分时专用的项目：\n\n![](https://r4ds.hadley.nz/diagrams/new-project.png)\n\n随后在脚本编辑器中输入以下命令并保存文件，将其命名为 “diamonds.R”。再创建一个名为 “data” 的新文件夹。最后，运行完整脚本，该脚本会将相关 PNG 和 CSV 文件保存到项目目录中。本书后续会对这些文件进行探索。\n\n```R\nlibrary(tidyverse)\n\nggplot(diamonds, aes(x = carat, y = price)) + \n  geom_hex()\nggsave(\"diamonds.png\")\n\nwrite_csv(diamonds, \"data/diamonds.csv\")\n```\n\n退出 RStudio，在电脑上找到该项目文件夹，双击`.Rproj`文件即可重新打开项目。\n\n\n\n###  相对和绝对路径\n\n一旦进入项目，就最好只使用**相对路径**，而非绝对路径。\n\n为什么？举例说明：如果一个叫 Dingjia 的人做了个项目，编辑了一个`data/diamonds.csv`文件，显然使用的是相对路径，而其绝对路径为` /Users/Dingjia/Documents/r4ds/data/diamonds `。现在协作者 Zhangsan 要在自己的电脑上运行代码，即可正常进行，因为相对路径指向的绝对路径为`/Users/Zhangsan/Documents/r4ds/data/diamonds`。\n\n从以上例子可以看出，使用相对路径对于共享协作意义非凡。\n\n但还有一点要注意，不同操作系统的分隔符存在差异，例如Mac 和 Linux 使用正斜杠（`/`），Windows 使用反斜杠（`\\` ）。在 R 中，反斜杠需要连续键入两个才可被识别，这很繁琐恼人，故建议直接使用正斜杠。","srcMarkdownNoYaml":"\n\n\n本章介绍用于组织代码的两个基本要素：脚本、项目。\n\n##脚本\n\n当工作变得更加复杂时，只用控制台运行代码显得力不从心，此时可使用脚本。在 RStudio 中，点击“文件”菜单，选择新建 R 脚本即可出现空白脚本。此时共有四个窗口，如图所示。\n\n![](https://r4ds.hadley.nz/diagrams/rstudio/script.png)\n\n##### 6.1.1 运行代码\n\n脚本编辑器是构建复杂ggplot图或长管道的最佳位置。\n\n快捷键如下：\n\n- Ctrl + Enter，在控制台执行当前一行代码。\n\n- Ctrl + Shift + S，一步执行完整脚本。\n\n建议使用`library(所需的包)`作为脚本开头。这样，如果要共享代码，可以让他人知晓需要安装的软件包。但绝不应包含在共享脚本中加`install.packages(\"包\")`，不太厚道。\n\n### RStudio 诊断\n\n在脚本编辑器中，RStudio 将在左侧边栏中用红色波浪线和叉号突出显示语法错误（前提是脚本已被创建并保存）：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic.png)\n\n将鼠标悬停在红叉上以查看问题：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic-tip.png)\n\nRStudio 还会通过警示符标注潜在问题：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-diagnostic-warn.png)\n\n### 保存与命名\n\nRStudio 会在退出时自动保存脚本编辑器的内容，并在重新打开时自动重新加载它。尽管如此贴心，但还是建议自己保存并命名。\n\n命名有以下原则：\n\n1. 文件名应该是**机器**可读的：避免使用空格、特殊字符。不要依赖区分大小写来区分文件。\n2. 文件名应该是**人类**可读的：可使用文件名来描述文件内容。\n3. 可让系列文件名以字母或数字顺序开头，以便按实际使用顺序排列它们。\n\n以下举例。请看一个奇葩文件夹中的各文件名：\n\n```R\nalternative model.R #有空格\ncode for exploratory analysis.r #有空格且繁杂\nfinalreport.qmd\nFinalReport.qmd #妄图通过大小写区分文件\nfig 1.png #有空格\nFigure_02.png #与上面fig1格式不统一\nmodel_first_try.R\nrun-first.r #没描述内容\ntemp.txt #没描述内容\n```\n\n修改名称后如下：\n\n```\n01-load-data.R\n02-exploratory-analysis.R\n03-model-approach-1.R\n04-model-approach-2.R\nfig-01.png\nfig-02.png\nreport-2022-03-20.qmd\nreport-2022-04-02.qmd\nreport-draft-notes.txt\n```\n\n\n\n## 项目\n\n有时我们需要暂时退出 R，稍后再返回分析；有时我们需要将外部数据导入 R，处理后再对外反馈。\n\n要处理这两种情况，需要认清两个问题：\n\n1. 真理的源头是什么？或者说什么文件能够永久记录我们曾做过的工作？\n2. 我们所做的分析位于何处？\n\n\n\n### 真理的源头\n\n作为初学者，可以依靠当前 R 环境来保留在整个分析过程中创建的所有对象。但是为了更轻松地处理大型项目或与他人协作，**真理的源头应该是 R 脚本**。\n\n**使用 R 脚本（和数据文件），我们才能重新创建环境。**相反，仅使用当前环境，重新创建 R 脚本则要困难得多，要么必须从内存中重新键入大量代码（在此过程中不可避免地会犯错误），要么必须仔细挖掘 R 历史记录。\n\n为了保证让 R 脚本成为一切事实的根据，强烈建议设置不要在 RStudio 会话之间保留工作区。即做到两点：\n\n- 取消勾选`RData into workspace`\n- 设置`Save workspace to .RData on exit:`为`Never`\n\n如下图所示即可：\n\n![](https://r4ds.hadley.nz/diagrams/rstudio/clean-slate.png)\n\n或许这会带来一些短期的不便，因为现在重新启动 RStudio 时，它将不再记住上次运行的代码，所创建的对象或读取的数据集也将无影无踪。\n\n但是短期的不便可以省去长期的痛苦，它会迫使我们在代码中专注于所有重要的过程。\n\n书中在此推荐两个快捷键：\n\n1. 按 Cmd/Ctrl + Shift + 0/F10 重新启动 R。\n2. 按 Cmd/Ctrl + Shift + S 重新运行当前脚本。\n\n> **RStudio 服务器**\n>\n> 如果使用的是 RStudio 服务器，则默认情况下永远不会重新启动 R 会话。当关闭 RStudio 服务器选项卡时，实际上服务器仍会在后台运行。下次返回时，会发现与上次离开的地方一模一样。因此定期重启变得更加重要，这样才便于从头开始。\n\n\n\n##### 6.2.2 分析文件位于何处？\n\nR 的**工作目录**概念绝不可忽视。这是 R 查找要求它加载的文件的位置，以及它所放置的保存文件的位置。RStudio 在控制台顶部显示当前工作目录：\n\n![](https://r4ds.hadley.nz/screenshots/rstudio-wd.png)\n\n可以通过运行`getwd()`命令打印工作目录：\n\n```R\n> getwd()\n[1] \"C:/Users/LENOVO/Desktop/r_packages/BLIT/blit/R\"\n```\n\n可以从 R 中设置工作目录，但书中**不建议这样做**：\n\n```R\n> setwd(\"/path/to/my/CoolProject\")\n```\n\n因为有更好的方法管理工作——RStudio项目。\n\n\n\n### RStudio项目\n\n将项目的所有相关文件（输入数据、R 脚本、分析结果）全部保存在同一个目录中是非常明智的做法， RStudio 也对此提供了内置支持。\n\n下面实操为例，创建一个阅读本书剩余部分时专用的项目：\n\n![](https://r4ds.hadley.nz/diagrams/new-project.png)\n\n随后在脚本编辑器中输入以下命令并保存文件，将其命名为 “diamonds.R”。再创建一个名为 “data” 的新文件夹。最后，运行完整脚本，该脚本会将相关 PNG 和 CSV 文件保存到项目目录中。本书后续会对这些文件进行探索。\n\n```R\nlibrary(tidyverse)\n\nggplot(diamonds, aes(x = carat, y = price)) + \n  geom_hex()\nggsave(\"diamonds.png\")\n\nwrite_csv(diamonds, \"data/diamonds.csv\")\n```\n\n退出 RStudio，在电脑上找到该项目文件夹，双击`.Rproj`文件即可重新打开项目。\n\n\n\n###  相对和绝对路径\n\n一旦进入项目，就最好只使用**相对路径**，而非绝对路径。\n\n为什么？举例说明：如果一个叫 Dingjia 的人做了个项目，编辑了一个`data/diamonds.csv`文件，显然使用的是相对路径，而其绝对路径为` /Users/Dingjia/Documents/r4ds/data/diamonds `。现在协作者 Zhangsan 要在自己的电脑上运行代码，即可正常进行，因为相对路径指向的绝对路径为`/Users/Zhangsan/Documents/r4ds/data/diamonds`。\n\n从以上例子可以看出，使用相对路径对于共享协作意义非凡。\n\n但还有一点要注意，不同操作系统的分隔符存在差异，例如Mac 和 Linux 使用正斜杠（`/`），Windows 使用反斜杠（`\\` ）。在 R 中，反斜杠需要连续键入两个才可被识别，这很繁琐恼人，故建议直接使用正斜杠。"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"ch6_workflow_scripts_projects.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","bibliography":["../references.bib"],"editor":"visual","theme":["cosmo","brand"],"title":"脚本与项目"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}